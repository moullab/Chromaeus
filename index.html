<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Chromaeus ‚Äî extend color to analysis</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app" id="app">
  <div class="topbar" style="grid-template-columns:1fr auto auto auto;"> <div class="brand">
      <div class="badge"></div>
      <div>
        <div class="brandTitle">Chromaeus</div>
        <div class="brandTag">extend color to analysis</div>
      </div>
    </div>

    <div class="row">
      <div id="themeSwitch" class="switch" role="button" tabindex="0" title="Toggle light/dark"></div>
      <span class="switchLabel" id="themeName">Light</span>
    </div>

    <div class="help-wrapper">
        <button class="btn salmon tiny" id="helpBtn">How to use</button>
        <div class="help-dropdown" id="helpDropdown">
            <div class="help-section">
                <h5>Guides</h5>
                <a class="help-link" id="linkImg">UI Overview</a>
            </div>
            <div class="help-section">
                <h5>Videos</h5>
                <a class="help-link" id="linkVidGen">General Description</a>
                <a class="help-link" id="linkVidWork">Basic Workflow</a>
            </div>
            <div class="help-section">
                <h5>About</h5>
                <a class="help-link" id="linkCite">How to cite</a>
            </div>
        </div>
    </div>

    <div class="row">
      <input id="fileInput" type="file" accept="image/*, .tif, .tiff"/>
    </div>
  </div>

  <div class="ribbon">
    <div class="card general">
      <h4>General</h4>
      <div class="row" style="gap:6px">
        <span class="mini">Zoom</span>
        <input id="zoomSlider" type="range" min="10" max="500" value="100" style="flex:1"/>
        <span id="zoomVal" class="pill">100%</span>
      </div>
      <div class="generalRow">
        <div class="btnGroup">
          <button class="btn tiny" id="undoBtn">Undo</button>
          <button class="btn tiny" id="redoBtn">Redo</button>
          <button class="btn tiny" id="resetBtn">Reset</button>
        </div>
        <div class="btnGroup">
          <button class="togglebtn on tiny" id="toggleTableBtn">Table</button>
          <button class="togglebtn tiny" id="toggleSwatchesBtn">Swatches</button>
          <button class="btn primary tiny" id="openCalib">Calculation</button>
        </div>
        <div class="btnGroup">
          <button class="btn tiny" id="copyBtn">Copy</button>
          <button class="btn tiny" id="exportBtn">Export</button>
        </div>
      </div>
    </div>

    <div class="card selection">
      <h4>Selection</h4>
      <div class="stackV">
        <div class="row" style="gap:6px">
            <button class="chipbtn active" id="toolRect" style="flex:1">‚ñ≠</button>
            <button class="chipbtn" id="toolCircle" style="flex:1">‚óØ</button>
            <label class="checkLabel" title="Use a fixed size for every selection">
    <input type="checkbox" id="fixedModeCheck">
    <span>Fixed</span>
</label>
        </div>
        
        <div class="row" style="gap:6px">
            <button class="chipbtn" id="toolWand" style="flex:1">ü™Ñ Auto</button>
            <input type="number" id="wandTol" value="15" min="1" max="100" title="Tolerance %" style="width:48px; text-align:center; padding:4px;">
            <span class="mini">%</span>
        </div>
      </div>
    </div>

    <div class="card colors">
      <h4>Color spaces</h4>
      <div class="grid2" id="spaceButtons">
        <button class="chipbtn active" data-space="RGB">RGB</button>
        <button class="chipbtn" data-space="CMYK">CMYK</button>
        <button class="chipbtn" data-space="LAB">CIELAB</button>
        <button class="chipbtn" data-space="HSV">HSV</button>
      </div>
    </div>

    <div class="card columns">
      <h4>Columns</h4>
      <div id="colToggles" style="display:grid;grid-template-columns:repeat(9,auto);gap:6px"></div>
    </div>
  </div>

  <div class="main">
    <div class="canvasWrap" id="canvasWrap">
      <div class="innerCanvas" id="innerCanvas">
        <canvas id="canvas" width="1280" height="720"></canvas>
      </div>
    </div>

    <div class="roiBar" id="roiBar" style="display:none"></div>
  </div>

  <div class="floatTable" id="floatTable">
    <div class="floatTableHead">Results</div>
    <div class="floatTableBody">
      <table>
        <thead><tr id="theadRow"></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <div class="drawer" id="calibDrawer" aria-hidden="true">
    <div class="dragHandle" id="dragHandle" title="Drag to resize"></div>
    <div class="drawerHead">
      <div style="font-weight:800">Calculation <span class="beta-tag">beta</span></div>
      <div class="row"><button class="btn tiny" id="closeCalib">Close</button></div>
    </div>
    <div class="drawerBody">
      <div class="drawerSection">
        <div class="row" style="justify-content:space-between;gap:6px;flex-wrap:wrap">
          <div class="row" style="gap:6px">
            <button class="btn tiny" id="calibNew">New</button>
            <button class="btn tiny" id="calibSave">Save</button>
            <button class="btn tiny" id="calibSaveAs">Save As</button>
            <select id="calibLoad" title="Saved calibrations"></select>
          </div>
          <div style="min-width:200px"><input id="calibName" type="text" placeholder="Calibration name"/></div>
        </div>
      </div>

      <div class="drawerSection">
        <h4>A) Data selection</h4>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <div style="min-width:150px">
            <label class="mini">Metric (Y)</label>
            <select id="metricSelect">
              <option value="meanRGB">Mean RGB</option>
              <option value="R">R</option><option value="G">G</option><option value="B">B</option>
              <option value="H">H</option><option value="S">S</option><option value="V">V</option>
              <option value="L">L*</option><option value="a">a*</option><option value="b">b*</option>
              <option value="C">C</option><option value="M">M</option><option value="Y">Y</option><option value="K">K</option>
            </select>
          </div>
          <div style="min-width:140px">
            <label class="mini">Unit</label>
            <input id="unitInput" type="text" value="mg L^-1"/>
          </div>
        </div>
        <div style="max-height:220px; overflow:auto; margin-top:6px">
          <table class="tableLike" id="roiLevelTable">
            <thead><tr><th>Include</th><th>ROI</th><th>Level</th><th>Unit</th><th>Blank</th><th>Y</th></tr></thead>
            <tbody id="roiLevelTBody"></tbody>
          </table>
        </div>
      </div>

      <div class="drawerSection">
        <h4>B) Replicates & aggregation</h4>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <div style="min-width:160px">
            <label class="mini">Aggregation</label>
            <select id="aggMethod">
              <option value="mean">Mean</option>
              <option value="median">Median</option>
              <option value="trim10">Trimmed mean (10%)</option>
            </select>
          </div>
          <div style="min-width:160px">
            <label class="mini">Outlier tool</label>
            <select id="outlierTool">
              <option value="none">None</option>
              <option value="iqr">IQR rule</option>
              <option value="grubbs">Grubbs (approx)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="drawerSection">
        <h4>C) Fit options</h4>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <div style="width:100%; font-size:12px; margin-bottom:4px">
            <label class="mini">X-Transform</label>
            <div class="row" style="gap:10px; margin-top:4px">
              <label><input type="checkbox" id="tx_log10"> log‚ÇÅ‚ÇÄ(X)</label>
              <label><input type="checkbox" id="tx_ln"> ln(X)</label>
              <label><input type="checkbox" id="tx_inv"> 1 / X</label>
            </div>

            <label class="mini" style="margin-top:6px; display:block">Y-Transform</label>
            <div class="row" style="gap:10px; margin-top:4px">
              <label><input type="checkbox" id="ty_log10"> log‚ÇÅ‚ÇÄ(Y)</label>
              <label><input type="checkbox" id="ty_ln"> ln(Y)</label>
              <label><input type="checkbox" id="ty_inv"> 1 / Y</label>
            </div>
          </div>
          <div style="min-width:150px">
            <label class="mini">Fit model</label>
            <select id="fitModel">
              <option value="linear">Linear</option>
              <option value="log">Logarithmic (ln)</option>
              <option value="log10">Logarithmic (log‚ÇÅ‚ÇÄ)</option>
              <option value="exp">Exponential</option>
              <option value="poly2">Polynomial (2)</option>
              <option value="poly3">Polynomial (3)</option>
            </select>
          </div>
          <div style="min-width:150px">
            <label class="mini">Weighting</label>
            <select id="weighting">
              <option value="none">None</option>
              <option value="invY">1 / y</option>
              <option value="invY2">1 / y¬≤</option>
            </select>
          </div>
          <div style="min-width:150px">
            <label class="mini">Blank for LOD/LOQ</label>
            <select id="blankLevel"></select>
          </div>
          <div style="min-width:150px">
            <label class="mini">LOD/LOQ method</label>
            <select id="lodMethod">
              <option value="blank">Blank-based</option>
              <option value="resid">Residual-based</option>
              <option value="both">Both</option>
            </select>
          </div>
        </div>
      </div>

      <div class="drawerSection">
        <h4>D) Chart</h4>
        <div class="chart"><canvas id="chartCanvas" width="480" height="240"></canvas></div>
        <div class="eqbox" id="eqBox">Equation, R¬≤, LOD, LOQ will appear here.</div>
        <div class="row" style="justify-content:flex-end;gap:6px;margin-top:6px;flex-wrap:wrap">
          <button class="btn tiny" id="exportCurveCSV">Export CSV</button>
          <button class="btn tiny" id="exportCurvePNG">Export PNG</button>
        </div>
      </div>

      <div class="drawerSection">
        <h4>E) Measure sample</h4>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <div style="min-width:200px">
            <label class="mini">Use calibration</label>
            <select id="useCalib"></select>
          </div>
          <div>
            <label class="mini">Metrics</label>
            <div class="row" id="measureMetricBtns" style="gap:6px; flex-wrap:wrap"></div>
          </div>
        </div>
        <div id="measureResult" class="eqbox" style="margin-top:6px">No sample measured yet.</div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box">
    <button class="modal-close" id="modalClose">&times;</button>
    <h3 id="modalTitle" style="margin-top:0">Help</h3>
    <div class="modal-content" id="modalContent"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.js"></script>
<script src="js/math.js"></script>
<script src="js/app.js"></script>

</body>
</html>
